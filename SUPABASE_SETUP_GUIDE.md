# Руководство по настройке Supabase CMS

## Что такое Supabase?

Supabase - это открытая альтернатива Firebase, которая предоставляет:
- PostgreSQL базу данных
- Автоматически генерируемые API
- Встроенную админ-панель для управления данными
- Аутентификацию пользователей
- Хранилище файлов

## Пошаговая настройка

### 1. Создание проекта Supabase

1. Перейдите на [supabase.com](https://supabase.com)
2. Нажмите "Start your project"
3. Войдите через GitHub или создайте аккаунт
4. Нажмите "New Project"
5. Выберите организацию и заполните данные:
   - **Name**: `stroymaster-cms`
   - **Database Password**: создайте надежный пароль
   - **Region**: выберите ближайший регион (например, Europe West)
6. Нажмите "Create new project"

### 2. Получение ключей доступа

После создания проекта:

1. Перейдите в **Settings** → **API**
2. Скопируйте следующие данные:
   - **Project URL** (например: `https://abcdefgh.supabase.co`)
   - **anon public** ключ (начинается с `eyJ...`)

### 3. Настройка переменных окружения

1. Создайте файл `.env` в корне проекта:
```bash
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

2. Замените значения на ваши реальные данные из Supabase

### 4. Выполнение миграций

1. В Supabase перейдите в **SQL Editor**
2. Создайте новый запрос и выполните содержимое файла `supabase/migrations/001_create_products_table.sql`
3. Затем выполните `supabase/migrations/002_insert_existing_products.sql`
4. И наконец `supabase/migrations/003_insert_remaining_products.sql`

### 5. Проверка данных

1. Перейдите в **Table Editor**
2. Выберите таблицу `products`
3. Убедитесь, что все товары загружены корректно

## Управление товарами через Supabase

### Добавление нового товара

1. Откройте **Table Editor** → **products**
2. Нажмите **Insert** → **Insert row**
3. Заполните поля:
   - **name**: название товара
   - **price**: цена (0 для "по запросу")
   - **image**: URL изображения
   - **description**: описание
   - **category**: категория (выберите из существующих)
   - **is_active**: true (товар активен)
4. Нажмите **Save**

### Редактирование товара

1. Найдите товар в таблице `products`
2. Нажмите на строку для редактирования
3. Измените нужные поля
4. Нажмите **Save**

### Деактивация товара

Вместо удаления товара рекомендуется его деактивировать:
1. Найдите товар в таблице
2. Измените поле `is_active` на `false`
3. Товар исчезнет с сайта, но останется в базе данных

### Управление категориями

Категории создаются автоматически при добавлении товаров. Для изменения категории:
1. Отредактируйте поле `category` у товара
2. Новая категория появится в фильтрах автоматически

## Преимущества Supabase CMS

### Для клиента:
- **Простота**: интуитивно понятный интерфейс
- **Безопасность**: все изменения логируются
- **Доступность**: работает из любого браузера
- **Бесплатно**: до 500 МБ данных и 2 ГБ трафика в месяц

### Для разработчика:
- **Автоматические API**: не нужно писать backend
- **Real-time обновления**: изменения отображаются мгновенно
- **Типизация**: автоматическая генерация TypeScript типов
- **Масштабируемость**: PostgreSQL выдерживает высокие нагрузки

## Дополнительные возможности

### Загрузка изображений

1. Перейдите в **Storage**
2. Создайте bucket `product-images`
3. Настройте публичный доступ
4. Загружайте изображения и используйте их URL в товарах

### Создание пользователей-администраторов

1. Перейдите в **Authentication** → **Users**
2. Нажмите **Add user**
3. Создайте аккаунт для сотрудника
4. Предоставьте доступ к Supabase Dashboard

### Резервное копирование

1. Перейдите в **Settings** → **Database**
2. Настройте автоматические бэкапы
3. Или экспортируйте данные вручную через SQL Editor

## Устранение проблем

### Товары не загружаются
1. Проверьте переменные окружения в `.env`
2. Убедитесь, что миграции выполнены
3. Проверьте консоль браузера на ошибки

### Ошибки доступа
1. Проверьте RLS политики в **Authentication** → **Policies**
2. Убедитесь, что anon ключ корректный

### Медленная загрузка
1. Добавьте индексы для часто используемых полей
2. Оптимизируйте изображения (используйте WebP формат)

## Контакты и поддержка

- [Документация Supabase](https://supabase.com/docs)
- [Сообщество Discord](https://discord.supabase.com)
- [GitHub Issues](https://github.com/supabase/supabase/issues)

## Стоимость

- **Free tier**: 500 МБ данных, 2 ГБ трафика, 50 МБ файлов
- **Pro**: $25/месяц - 8 ГБ данных, 250 ГБ трафика, 100 ГБ файлов
- **Team**: $599/месяц - для команд с расширенными возможностями

Для большинства интернет-магазинов бесплатного тарифа достаточно на начальном этапе.